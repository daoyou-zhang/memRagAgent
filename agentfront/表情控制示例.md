# ğŸ­ 3D æ¨¡å‹è¡¨æƒ…æ§åˆ¶æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

å¦‚æœä½ ä½¿ç”¨ VRoid Studio åˆ›å»ºçš„æ¨¡å‹ï¼Œå®ƒä¼šè‡ªå¸¦ 52 ç§è¡¨æƒ…ï¼ˆBlend Shapes / Morph Targetsï¼‰ã€‚
æœ¬æŒ‡å—å±•ç¤ºå¦‚ä½•åœ¨ä»£ç ä¸­æ§åˆ¶è¿™äº›è¡¨æƒ…ã€‚

---

## ğŸ¨ VRoid æ¨¡å‹çš„è¡¨æƒ…åˆ—è¡¨

### åŸºç¡€è¡¨æƒ…ï¼ˆ6 ç§ï¼‰
- `Joy` - å¼€å¿ƒ ğŸ˜Š
- `Angry` - ç”Ÿæ°” ğŸ˜ 
- `Sorrow` - æ‚²ä¼¤ ğŸ˜¢
- `Fun` - æœ‰è¶£ ğŸ˜„
- `Surprised` - æƒŠè®¶ ğŸ˜²
- `Neutral` - ä¸­æ€§ ğŸ˜

### çœ¼éƒ¨è¡¨æƒ…ï¼ˆ10+ ç§ï¼‰
- `Blink` - çœ¨çœ¼
- `Blink_L` - å·¦çœ¼çœ¨çœ¼
- `Blink_R` - å³çœ¼çœ¨çœ¼
- `LookUp` - å‘ä¸Šçœ‹
- `LookDown` - å‘ä¸‹çœ‹
- `LookLeft` - å‘å·¦çœ‹
- `LookRight` - å‘å³çœ‹

### å˜´éƒ¨è¡¨æƒ…ï¼ˆ5 ç§ï¼‰
- `A` - å•Šï¼ˆå¼ å¤§å˜´ï¼‰
- `I` - ä¾ï¼ˆå¾®ç¬‘ï¼‰
- `U` - å‘œï¼ˆå˜Ÿå˜´ï¼‰
- `E` - è¯¶ï¼ˆå’§å˜´ï¼‰
- `O` - å“¦ï¼ˆåœ†å˜´ï¼‰

---

## ğŸ’» ä»£ç å®ç°

### 1. æ›´æ–° BeautifulAvatarModel.tsx

```typescript
/**
 * å¸¦è¡¨æƒ…æ§åˆ¶çš„ 3D ç¾å¥³æ¨¡å‹
 */
import React, { useRef, useEffect, useState } from 'react';
import { useFrame } from '@react-three/fiber';
import { useGLTF, useAnimations } from '@react-three/drei';
import * as THREE from 'three';

interface BeautifulAvatarProps {
  emotion?: 'neutral' | 'happy' | 'thinking' | 'surprised' | 'sad';
  isSpeaking?: boolean;
  modelUrl?: string;
}

const BeautifulAvatarModel: React.FC<BeautifulAvatarProps> = ({ 
  emotion = 'neutral', 
  isSpeaking = false,
  modelUrl = '/models/avatar.glb'
}) => {
  const groupRef = useRef<THREE.Group>(null);
  const [morphTargets, setMorphTargets] = useState<any>(null);
  
  const { scene, animations } = useGLTF(modelUrl);
  const { actions, mixer } = useAnimations(animations, groupRef);
  
  // æŸ¥æ‰¾ Morph Targetsï¼ˆè¡¨æƒ…ï¼‰
  useEffect(() => {
    if (scene) {
      scene.traverse((child: any) => {
        if (child.isMesh && child.morphTargetDictionary) {
          console.log('ğŸ­ æ‰¾åˆ°è¡¨æƒ…ç³»ç»Ÿ:', Object.keys(child.morphTargetDictionary));
          setMorphTargets(child);
        }
      });
    }
  }, [scene]);
  
  // æ§åˆ¶è¡¨æƒ…
  useEffect(() => {
    if (!morphTargets) return;
    
    const dict = morphTargets.morphTargetDictionary;
    const influences = morphTargets.morphTargetInfluences;
    
    // é‡ç½®æ‰€æœ‰è¡¨æƒ…
    Object.keys(dict).forEach(key => {
      influences[dict[key]] = 0;
    });
    
    // æ ¹æ®æƒ…ç»ªè®¾ç½®è¡¨æƒ…
    switch (emotion) {
      case 'happy':
        if (dict['Joy']) influences[dict['Joy']] = 1.0;
        break;
      case 'thinking':
        if (dict['Fun']) influences[dict['Fun']] = 0.5;
        if (dict['LookUp']) influences[dict['LookUp']] = 0.3;
        break;
      case 'surprised':
        if (dict['Surprised']) influences[dict['Surprised']] = 1.0;
        break;
      case 'sad':
        if (dict['Sorrow']) influences[dict['Sorrow']] = 1.0;
        break;
      default:
        // neutral - æ‰€æœ‰è¡¨æƒ…éƒ½æ˜¯ 0
        break;
    }
    
    console.log(`ğŸ­ åˆ‡æ¢è¡¨æƒ…: ${emotion}`);
  }, [emotion, morphTargets]);
  
  // è¯´è¯åŠ¨ç”»ï¼ˆå˜´éƒ¨ï¼‰
  useFrame((state) => {
    if (morphTargets && isSpeaking) {
      const dict = morphTargets.morphTargetDictionary;
      const influences = morphTargets.morphTargetInfluences;
      
      // å˜´å·´åŠ¨ç”»ï¼ˆA-I-U-E-O å¾ªç¯ï¼‰
      const time = state.clock.elapsedTime;
      const mouthValue = Math.abs(Math.sin(time * 10)) * 0.8;
      
      if (dict['A']) influences[dict['A']] = mouthValue;
      if (dict['I']) influences[dict['I']] = mouthValue * 0.5;
    } else if (morphTargets) {
      // åœæ­¢è¯´è¯æ—¶ï¼Œé‡ç½®å˜´éƒ¨
      const dict = morphTargets.morphTargetDictionary;
      const influences = morphTargets.morphTargetInfluences;
      
      if (dict['A']) influences[dict['A']] *= 0.9;
      if (dict['I']) influences[dict['I']] *= 0.9;
    }
    
    // è‡ªåŠ¨çœ¨çœ¼
    if (morphTargets) {
      const dict = morphTargets.morphTargetDictionary;
      const influences = morphTargets.morphTargetInfluences;
      const blinkTime = state.clock.elapsedTime % 4;
      
      if (blinkTime > 3.8 && blinkTime < 3.9 && dict['Blink']) {
        influences[dict['Blink']] = 1.0;
      } else if (dict['Blink']) {
        influences[dict['Blink']] = 0;
      }
    }
    
    // å‘¼å¸æ•ˆæœ
    if (groupRef.current) {
      groupRef.current.position.y = Math.sin(state.clock.elapsedTime * 0.8) * 0.03 - 0.8;
    }
  });
  
  return (
    <group ref={groupRef}>
      <primitive 
        object={scene} 
        scale={1.8}
        position={[0, -1, 0]}
      />
    </group>
  );
};

export default BeautifulAvatarModel;
```

---

## ğŸ® ä½¿ç”¨ç¤ºä¾‹

### åœ¨ DigitalPersonPage.tsx ä¸­ä½¿ç”¨

```typescript
// æ ¹æ®å¯¹è¯å†…å®¹è‡ªåŠ¨åˆ‡æ¢è¡¨æƒ…
const [emotion, setEmotion] = useState<'neutral' | 'happy' | 'thinking' | 'surprised' | 'sad'>('neutral');

// åˆ†ææ¶ˆæ¯å†…å®¹ï¼Œè®¾ç½®è¡¨æƒ…
const analyzeEmotion = (text: string) => {
  if (text.includes('å¼€å¿ƒ') || text.includes('å“ˆå“ˆ') || text.includes('ğŸ˜Š')) {
    setEmotion('happy');
  } else if (text.includes('æƒ³æƒ³') || text.includes('æ€è€ƒ') || text.includes('ğŸ¤”')) {
    setEmotion('thinking');
  } else if (text.includes('æƒŠè®¶') || text.includes('å“‡') || text.includes('ğŸ˜²')) {
    setEmotion('surprised');
  } else if (text.includes('éš¾è¿‡') || text.includes('ä¼¤å¿ƒ') || text.includes('ğŸ˜¢')) {
    setEmotion('sad');
  } else {
    setEmotion('neutral');
  }
};

// åœ¨æ”¶åˆ°æ¶ˆæ¯æ—¶è°ƒç”¨
onMessage: (data) => {
  if (data.type === 'content') {
    const text = data.data?.text || '';
    analyzeEmotion(text);
    // ... å…¶ä»–å¤„ç†
  }
}
```

---

## ğŸ¨ è¡¨æƒ…æ˜ å°„è¡¨

### æƒ…ç»ª â†’ VRoid è¡¨æƒ…

| æƒ…ç»ª | VRoid è¡¨æƒ… | å¼ºåº¦ | è¯´æ˜ |
|------|-----------|------|------|
| `neutral` | - | 0 | ä¸­æ€§ï¼Œæ— è¡¨æƒ… |
| `happy` | `Joy` | 1.0 | å¼€å¿ƒï¼Œå¾®ç¬‘ |
| `thinking` | `Fun` + `LookUp` | 0.5 + 0.3 | æ€è€ƒï¼Œå‘ä¸Šçœ‹ |
| `surprised` | `Surprised` | 1.0 | æƒŠè®¶ï¼Œçå¤§çœ¼ç› |
| `sad` | `Sorrow` | 1.0 | æ‚²ä¼¤ï¼Œä½å¤´ |
| `angry` | `Angry` | 1.0 | ç”Ÿæ°”ï¼Œçš±çœ‰ |

### åŠ¨ä½œ â†’ VRoid è¡¨æƒ…

| åŠ¨ä½œ | VRoid è¡¨æƒ… | å¼ºåº¦ | è¯´æ˜ |
|------|-----------|------|------|
| è¯´è¯ | `A` + `I` | åŠ¨æ€ | å˜´å·´å¼ åˆ |
| çœ¨çœ¼ | `Blink` | 1.0 | æ¯ 4 ç§’ä¸€æ¬¡ |
| çœ‹å·¦ | `LookLeft` | 0.5 | çœ¼ç›å‘å·¦ |
| çœ‹å³ | `LookRight` | 0.5 | çœ¼ç›å‘å³ |
| çœ‹ä¸Š | `LookUp` | 0.5 | çœ¼ç›å‘ä¸Š |
| çœ‹ä¸‹ | `LookDown` | 0.5 | çœ¼ç›å‘ä¸‹ |

---

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. è¡¨æƒ…æ··åˆ

```typescript
// åŒæ—¶æ˜¾ç¤ºå¤šä¸ªè¡¨æƒ…
influences[dict['Joy']] = 0.7;      // 70% å¼€å¿ƒ
influences[dict['Surprised']] = 0.3; // 30% æƒŠè®¶
// ç»“æœï¼šæƒŠå–œçš„è¡¨æƒ…
```

### 2. å¹³æ»‘è¿‡æ¸¡

```typescript
// ä½¿ç”¨ lerp å®ç°å¹³æ»‘è¿‡æ¸¡
const targetValue = emotion === 'happy' ? 1.0 : 0.0;
influences[dict['Joy']] = THREE.MathUtils.lerp(
  influences[dict['Joy']], 
  targetValue, 
  0.1  // è¿‡æ¸¡é€Ÿåº¦
);
```

### 3. è‡ªå®šä¹‰è¡¨æƒ…

```typescript
// åˆ›å»ºè‡ªå®šä¹‰è¡¨æƒ…ç»„åˆ
const customExpressions = {
  shy: {  // å®³ç¾
    Joy: 0.3,
    Sorrow: 0.2,
    LookDown: 0.5
  },
  excited: {  // å…´å¥‹
    Joy: 1.0,
    Surprised: 0.5,
    A: 0.7
  }
};
```

---

## ğŸ“Š è¡¨æƒ…æµ‹è¯•å·¥å…·

### åˆ›å»ºè¡¨æƒ…æµ‹è¯•ç•Œé¢

```typescript
// åœ¨ DigitalPersonPage.tsx ä¸­æ·»åŠ 
<Box sx={{ position: 'absolute', top: 100, left: 20 }}>
  <Stack spacing={1}>
    <Button onClick={() => setEmotion('neutral')}>ä¸­æ€§</Button>
    <Button onClick={() => setEmotion('happy')}>å¼€å¿ƒ</Button>
    <Button onClick={() => setEmotion('thinking')}>æ€è€ƒ</Button>
    <Button onClick={() => setEmotion('surprised')}>æƒŠè®¶</Button>
    <Button onClick={() => setEmotion('sad')}>æ‚²ä¼¤</Button>
  </Stack>
</Box>
```

---

## ğŸ¯ å®Œæ•´æµç¨‹

### 1. åˆ›å»º VRoid æ¨¡å‹
- ä½¿ç”¨ VRoid Studio åˆ›å»ºç¾å¥³
- è‡ªåŠ¨åŒ…å« 52 ç§è¡¨æƒ…

### 2. å¯¼å‡ºå¹¶è½¬æ¢
- å¯¼å‡º VRM æ ¼å¼
- è½¬æ¢ä¸º GLB

### 3. æ›´æ–°ä»£ç 
- ä½¿ç”¨ä¸Šé¢çš„ä»£ç ç¤ºä¾‹
- æ·»åŠ è¡¨æƒ…æ§åˆ¶é€»è¾‘

### 4. æµ‹è¯•è¡¨æƒ…
- ä½¿ç”¨æµ‹è¯•æŒ‰é’®
- è§‚å¯Ÿè¡¨æƒ…å˜åŒ–

---

## ğŸ’¡ æç¤º

1. **VRoid æ¨¡å‹è‡ªå¸¦è¡¨æƒ…**
   - ä¸éœ€è¦é¢å¤–é…ç½®
   - ç›´æ¥å¯ç”¨

2. **è¡¨æƒ…å¼ºåº¦**
   - 0.0 = æ— è¡¨æƒ…
   - 1.0 = å®Œå…¨è¡¨æƒ…
   - å¯ä»¥æ··åˆå¤šä¸ªè¡¨æƒ…

3. **æ€§èƒ½ä¼˜åŒ–**
   - åªæ›´æ–°éœ€è¦çš„è¡¨æƒ…
   - ä½¿ç”¨å¹³æ»‘è¿‡æ¸¡
   - é¿å…é¢‘ç¹åˆ‡æ¢

4. **è°ƒè¯•æŠ€å·§**
   - æ‰“å° morphTargetDictionary æŸ¥çœ‹æ‰€æœ‰è¡¨æƒ…
   - ä½¿ç”¨æµ‹è¯•æŒ‰é’®å¿«é€Ÿæµ‹è¯•
   - è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—

---

## ğŸš€ å¼€å§‹ä½¿ç”¨

1. **åˆ›å»º VRoid æ¨¡å‹**ï¼ˆ30 åˆ†é’Ÿï¼‰
2. **å¯¼å‡ºå¹¶æ”¾ç½®**ï¼ˆ5 åˆ†é’Ÿï¼‰
3. **æ›´æ–°ä»£ç **ï¼ˆ10 åˆ†é’Ÿï¼‰
4. **æµ‹è¯•è¡¨æƒ…**ï¼ˆ5 åˆ†é’Ÿï¼‰

**æ€»æ—¶é—´ï¼šçº¦ 50 åˆ†é’Ÿ**

**ç»“æœ**ï¼šä¸€ä¸ªå¸¦å®Œæ•´è¡¨æƒ…ç³»ç»Ÿçš„ 3D ç¾å¥³ï¼

---

**äº«å—ä½ çš„è¡¨æƒ…ä¸°å¯Œçš„ 3D æ•°å­—äººå§ï¼** ğŸ­âœ¨
